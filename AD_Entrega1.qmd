---
title: "Entrega 1"
format: html
editor: visual
---

## 

## librerias

```{r}
library(tidyverse) 
library(ggplot2)
library(survival) 
library(readxl)
library(readr)
```

#### Cargar datos

Cargamos los datos y observamos si se han cargado bien.

```{r}
 #### Cargar datos
Arkansas <- read_excel("Input/Arkansas.xlsx")

print(Arkansas)

```

Observamos que para algunas variables no se ha indentifado correctamente el tipo que son.

```{r}
Arkansas$ASPC = as.numeric(Arkansas$ASPC)
Arkansas$BMPC = as.numeric(Arkansas$BMPC)
```

Este dataset está formado por 565 observaciones pertenecientes a pacientes con Mieloma Múltiple (un tipo de cancer que se origina en la médula ósea). Cada obersvación cuenta con 23 variables, hagamos un pequeño repaso de estas y para aquellas variables cínicas, analicemos cuáles deberían ser los valores para una persona sana. Los datos han sido extraidos del portal MayoClínic.

-   PATID. Nos indica la identifación del paciente.

-   PROT. Nos indica el tratamiento que se le aplicó al paciente, TT2 o TT3

-   AGE. Nos indica la edad del paciente expresada en años.

-   SEX. Nos indica el sexo del paciente, "male" o "female"

-   RACE. Nos indica la raza del paciente, "white" o "other"

-   ISOTYPE. El isotipo del paciente, "IgA", "IgG", "IgM" o "IgE"

-   B2M. Nos indica la Microglobulina beta-2, expresada en mg/l

-   CRP. Nos indica la Proteina C-Reactiva, expresada en mg/l

-   CREAT. Nos indica la creatinina, expresada en mg/dl. Según MayoClínic, el rango normal para personas adulto s es entre 0,74 y 1,35m mg/dl para los hombres y entre 0,59 y 1,04 mg/dl.

-   LDH. Nos indica el Lactato Deshidrogenasa, expresada en U/l (unidades por litro.

-   ALB. Nos indica la Albúmina, expresada en g/l

-   HGB. Nos indica la Hemoglobinal, expresada en g/dl

-   ASPC. Nos indica las Células plasmáticas en aspirado de médula ósea, se expresa como un porcentaje de las células malignas.

-   BMPC. Nos indica Células plasmáticas en biopsia de médula ósea, se como el porcentaje de células plasmáticas de biopsia presentes en la médula ósea.

-   MRI. Nos indica el número de lesiones focales definidas por resonancia magnéticaIndica el número de lesiones focales visibles en una resonancia magnética, que suelen estar presentes en huesos como el cráneo, la columna y la pelvis.

**OTRAS**




```{r}
library(ggplot2)
library(dplyr)

# Filtrar los datos para hombres y mujeres
datos_filtrados <- Arkansas %>% 
  filter(SEX %in% c("male", "female")) %>%  # Filtrar solo para hombres y mujeres
  mutate(Persona = 1:n())  # Crear un identificador para cada persona

# Definir el rango saludable específico para cada sexo
rango_sano <- tibble(
  SEX = c("male", "female"),
  rango_sano_min = c(0.74, 0.59),  # Rango mínimo para hombres y mujeres
  rango_sano_max = c(1.35, 1.04)   # Rango máximo para hombres y mujeres
)

# Unir los rangos saludables con los datos filtrados
datos_filtrados <- datos_filtrados %>% 
  left_join(rango_sano, by = "SEX")

# Crear el gráfico con facetado por 'SEX'
ggplot(datos_filtrados, aes(x = Persona, y = CREAT, color = SEX)) +
  # Rango saludable sombreado para cada sexo
  geom_rect(aes(xmin = min(Persona) - 0.5, xmax = max(Persona) + 0.5, 
                ymin = rango_sano_min, ymax = rango_sano_max),
            fill = "green", alpha = 0.1) +  # Sombreado de rango sano
  # Puntos observados con dispersión
  geom_jitter(width = 0.2, size = 1.2) +  # Puntos con dispersión horizontal
  # Líneas horizontales para el rango saludable
  geom_hline(aes(yintercept = rango_sano_min), color = "red", size = 0.5) +  # Línea continua inferior del rango sano
  geom_hline(aes(yintercept = rango_sano_max), color = "red", size = 0.5) +  # Línea continua superior del rango sano
  # Títulos y etiquetas
  labs(title = "Valores de Creatinina por Sexo", 
       x = NULL, y = "Nivel de Creatinina (mg/dL)", 
       color = "Sexo") +
  # Facetado por sexo
  facet_grid(~SEX) +  
  # Tema minimalista
  theme(
    plot.title = element_text(size = 18, face = "bold"),  # Título más grande y en negrita
    axis.title = element_text(size = 14),  # Etiquetas de ejes más grandes
    axis.text = element_text(size = 12),    # Texto de los ejes más grande
    axis.text.x = element_blank(),  # Quitar números del eje X
    axis.ticks.x = element_blank(),  # Quitar marcas del eje X
    strip.text = element_blank(),  # Quitar etiquetas del facetado
    legend.title = element_text(size = 14),  # Título de la leyenda
    legend.text = element_text(size = 12),  # Texto de la leyenda
    legend.position = "right"  # Posicionar la leyenda en la parte inferior
  ) +
  scale_color_manual(values = c("male" = "blue", "female" = "black"),
                     labels = c("male" = "Hombre", "female" = "Mujer")) +  # Colores y etiquetas personalizadas para la leyenda
  # Añadir anotaciones específicas en cada gráfico
  geom_text(data = filter(datos_filtrados, SEX == "male"), 
            aes(x = Inf, y = Inf, label = paste("Rango saludable: ", 
                                                "0.74 - 1.35")), 
            hjust = 1.1, vjust = 1.1, size = 3.5, color = "black") +
  geom_text(data = filter(datos_filtrados, SEX == "female"), 
            aes(x = Inf, y = Inf, label = paste("Rango saludable: ", 
                                                "0.65 - 1.25")), 
            hjust = 1.1, vjust = 1.1, size = 3.5, color = "black")

```

